# JWT过期检查功能说明

## 🎯 功能概述

原本的登录界面现在已添加JWT过期检查和自动登出功能，确保用户token过期后会自动退出登录。

## ✨ 新增功能

### 1. **自动JWT过期检查**
- 每分钟自动检查JWT token是否过期
- 过期后自动清除token并跳转到登录页
- 显示友好的过期提示信息

### 2. **路由守卫增强**
- 每次路由切换时验证token有效性
- 过期token无法访问受保护页面
- 自动重定向到登录页面

### 3. **用户界面增强**
- 登录成功后显示"JWT过期检查已启用"提示
- 添加"查看JWT过期时间"按钮
- 实时显示token剩余有效时间

## 🔧 技术实现

### 修改的文件

#### `src/pinia/stores/user.ts`
- 添加 `checkTokenExpiration()` 方法
- 添加定时器自动检查token过期
- 增强 `logout()` 和 `resetToken()` 方法

#### `src/router/guard.ts`
- 在路由守卫中添加token有效性检查
- 过期token自动重定向到登录页

#### `src/main.ts`
- 应用启动时初始化JWT检查功能

#### `src/pages/login/index2.vue`
- 添加JWT过期时间显示功能
- 增强登录成功提示

## 🚀 使用方法

### 1. **正常登录流程**
1. 访问 http://localhost:3333/login
2. 输入用户名和密码
3. 点击"登录"按钮
4. 系统自动启用JWT过期检查

### 2. **查看JWT过期时间**
1. 登录成功后，点击"查看JWT过期时间"按钮
2. 系统显示token剩余有效时间
3. 格式：`Token还有 X分Y秒 过期`

### 3. **自动登出机制**
- **定时检查**: 每分钟自动检查一次
- **路由检查**: 每次页面跳转时检查
- **过期处理**: 自动清除token并跳转登录页

## ⚙️ 配置说明

### JWT检查间隔
```typescript
// 在 user.ts 中修改检查间隔（默认60秒）
setInterval(() => {
  checkTokenExpiration()
}, 60000) // 60秒 = 1分钟
```

### 过期提示消息
```typescript
// 在 user.ts 中自定义过期提示
ElMessage.error("登录已过期，请重新登录")
```

## 🔍 测试方法

### 1. **快速测试**
1. 登录系统
2. 等待JWT过期（默认1分钟）
3. 观察是否自动退出

### 2. **手动测试**
1. 登录后点击"查看JWT过期时间"
2. 尝试访问受保护页面
3. 检查路由守卫是否生效

### 3. **后端测试**
1. 修改后端JWT过期时间为更短时间
2. 测试前端是否及时响应过期

## 🐛 故障排除

### 常见问题

#### Q: JWT检查不生效？
A: 检查浏览器控制台是否有错误，确认token格式正确

#### Q: 定时器不工作？
A: 检查是否有JavaScript错误，确认setInterval正常执行

#### Q: 路由守卫不生效？
A: 检查router配置，确认guard.ts正确导入

### 调试方法
1. 打开浏览器开发者工具
2. 查看Console日志
3. 检查Network请求
4. 验证localStorage/cookies中的token

## 📝 注意事项

1. **性能考虑**: JWT检查间隔不宜过短，避免影响性能
2. **用户体验**: 过期提示要友好，避免突然跳转
3. **安全性**: 过期token必须立即清除，不能延迟
4. **兼容性**: 确保在不同浏览器中正常工作

## 🔄 更新日志

- **v1.0.0**: 初始版本，添加基本JWT过期检查
- **v1.1.0**: 增强路由守卫，添加定时检查
- **v1.2.0**: 优化用户界面，添加过期时间显示

---

**开发者**: AI Assistant  
**最后更新**: 2024年12月  
**版本**: 1.2.0
